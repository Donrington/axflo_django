{% extends 'axflo_app/admin/admin_base.html' %}
{% load static %}

{% block title %}Edit Job Posting - Axflo{% endblock %}

{% block content %}
<div class="career-form-container">
    <div class="career-form-card">
        <div class="career-form-header">
            <h1><i class="fas fa-edit"></i> Edit Job Posting</h1>
            <p class="subtitle">Update job details for "{{ job.title }}"</p>
        </div>
        
        <form method="post" class="career-form-body" id="careerForm">
            {% csrf_token %}
            
            <div class="form-section">
                <h3 class="section-title"><i class="fas fa-info-circle"></i> Basic Information</h3>
                <div class="form-grid">
                    <div class="career-form-group">
                        <label for="title" class="required"><i class="fas fa-briefcase"></i> Job Title</label>
                        <input type="text" id="title" name="title" class="career-input" value="{{ job.title }}" required placeholder="Enter job title">
                    </div>

                    <div class="career-form-group">
                        <label for="department" class="required"><i class="fas fa-building"></i> Department</label>
                        <input type="text" id="department" name="department" class="career-input" value="{{ job.department }}" required placeholder="Enter department name (e.g., Engineering, Marketing, Operations)">
                        <div class="input-hint">Specify the department or division for this position</div>
                    </div>

                    <div class="career-form-group">
                        <label for="employment_type" class="required"><i class="fas fa-clock"></i> Employment Type</label>
                        <select id="employment_type" name="employment_type" class="career-select" required>
                            {% for type_code, type_name in employment_types %}
                            <option value="{{ type_code }}" {% if type_code == job.employment_type %}selected{% endif %}>
                                {{ type_name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="career-form-group">
                        <label for="location" class="required"><i class="fas fa-map-marker-alt"></i> Location</label>
                        <input type="text" id="location" name="location" class="career-input" value="{{ job.location }}" required placeholder="e.g., Lagos, Nigeria">
                    </div>

                    <div class="career-form-group">
                        <label for="salary_range"><i class="fas fa-money-bill-wave"></i> Salary Range</label>
                        <input type="text" id="salary_range" name="salary_range" class="career-input" value="{{ job.salary_range }}" placeholder="e.g., ₦200,000 - ₦350,000 per month">
                        <div class="input-hint">Optional: Specify the salary range for transparency</div>
                    </div>

                    <div class="career-form-group">
                        <label for="status" class="required"><i class="fas fa-toggle-on"></i> Status</label>
                        <select id="status" name="status" class="career-select" required>
                            {% for status_code, status_name in status_choices %}
                            <option value="{{ status_code }}" {% if status_code == job.status %}selected{% endif %}>
                                {{ status_name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="career-form-group">
                        <label for="closing_date"><i class="fas fa-calendar-alt"></i> Application Closing Date</label>
                        <input type="date" id="closing_date" name="closing_date" class="career-input" 
                               value="{% if job.closing_date %}{{ job.closing_date|date:'Y-m-d' }}{% endif %}">
                        <div class="input-hint">Leave blank if no specific deadline</div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3 class="section-title"><i class="fas fa-file-alt"></i> Job Details</h3>
                <div class="form-grid single-column">
                    <div class="career-form-group">
                        <label for="description" class="required"><i class="fas fa-align-left"></i> Job Description</label>
                        <textarea id="description" name="description" class="career-textarea large" required placeholder="Describe the role, responsibilities, and what the successful candidate will be doing...">{{ job.description }}</textarea>
                        <div class="character-count" id="descriptionCount">0 characters</div>
                    </div>

                    <div class="career-form-group">
                        <label for="requirements" class="required"><i class="fas fa-list-check"></i> Requirements</label>
                        <textarea id="requirements" name="requirements" class="career-textarea large" required placeholder="List the qualifications, skills, and experience required for this position...">{{ job.requirements }}</textarea>
                        <div class="character-count" id="requirementsCount">0 characters</div>
                    </div>
                </div>
            </div>
        </form>
        
        <div class="career-form-actions">
            <div class="form-actions-left">
                <div class="save-indicator" id="saveIndicator">
                    <i class="fas fa-circle"></i>
                    <span>Changes not saved</span>
                </div>
            </div>
            <div class="form-actions-right">
                <a href="/admin-careers/" class="career-btn career-btn-secondary">
                    <i class="fas fa-arrow-left"></i>
                    Back to Jobs
                </a>
                <button type="submit" class="career-btn career-btn-primary" form="careerForm">
                    <i class="fas fa-save"></i>
                    Update Job Posting
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Set the current page for sidebar active state
    window.currentPage = 'careers';
    
    // Character count functionality
    function updateCharacterCount(textareaId, countId) {
        const textarea = document.getElementById(textareaId);
        const counter = document.getElementById(countId);
        
        if (textarea && counter) {
            const count = textarea.value.length;
            counter.textContent = `${count} characters`;
            
            // Add warning/error classes based on length
            counter.classList.remove('warning', 'error');
            if (count > 2000) {
                counter.classList.add('error');
            } else if (count > 1500) {
                counter.classList.add('warning');
            }
        }
    }
    
    // Track form changes for save indicator
    let hasChanges = false;
    
    function markAsChanged() {
        if (!hasChanges) {
            hasChanges = true;
            const indicator = document.getElementById('saveIndicator');
            indicator.innerHTML = '<i class="fas fa-exclamation-circle"></i> <span>Unsaved changes</span>';
            indicator.className = 'save-indicator saving';
        }
    }
    
    // Initialize character counters and change tracking
    document.addEventListener('DOMContentLoaded', function() {
        const descriptionTextarea = document.getElementById('description');
        const requirementsTextarea = document.getElementById('requirements');
        const form = document.getElementById('careerForm');
        
        // Character counters
        if (descriptionTextarea) {
            descriptionTextarea.addEventListener('input', () => {
                updateCharacterCount('description', 'descriptionCount');
                markAsChanged();
            });
            updateCharacterCount('description', 'descriptionCount');
        }
        
        if (requirementsTextarea) {
            requirementsTextarea.addEventListener('input', () => {
                updateCharacterCount('requirements', 'requirementsCount');
                markAsChanged();
            });
            updateCharacterCount('requirements', 'requirementsCount');
        }
        
        // Track changes on all form inputs
        if (form) {
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('change', markAsChanged);
                input.addEventListener('input', markAsChanged);
            });
        }
    });
</script>
{% endblock %}